<li id="<%= event.id %>">
<div class="row">

  <div class="col-xs-8 col-sm-8"> 
  <p><!--<strong>Title: </strong>-->
  <h3><%= link_to event.title, event %></h3></p>
  <p>Posted <%= time_ago_in_words(event.created_at) %> ago.</p>

</div>
<aside class="col-xs-4 col-sm-4">
  <%= image_tag ENV["S3_BUCKET"]+"badges/"+ Badge.find(School.find(event.loc_id).badge_id).file_name, class: "img-responsive" %>  
</aside>
<div class="col-xs-6 col-md-6">
<p><strong>Location: </strong> 
    <%= link_to handle_abbr(School.find(event.loc_id).school_name.titlecase), "/schools/#{event.loc_id}" %> </p>
  <p><strong>Time:</strong> <%= event.present_time()  %></p>
</div>
  <div class="col-xs-6 col-md-6">

  <p>
    <% if event.speaker_id > 0 %>
      <strong>Speaker: </strong>
      <%= User.find(event.speaker_id).name %>
    <% else %>
      <% unless event.claims.each.nil? %>
        <strong>Claims: </strong>
        <%= raw event.claims.where(active:true).each.map(&:user).map {|u| link_to u.name, user_path(u)  }.join(', ') %>
      <% end %>
    <% end %>
  </p>
  <p><strong>Organizer: </strong>
    <%= link_to event.user.name, event.user %></p>

  
  </div>
  <div class="col-xs-12 col-md-12">
  <p><strong>Tags: </strong>
    <%= raw event.tags.map(&:name).map { |t| link_to t, tag_path(t) }.join(', ') %></p>

  <p><strong>Description: </strong><%= event.content %></p>
  </div> <!-- column -->

  <p>
    <% if event.claims.where('confirmed_by_teacher = ?', true).count < 1 &&
            event.claims.where('user_id = ?', current_user.id).count < 1 &&
            event.user != current_user%>
        <%= button_to 'claim this event', claim_event_path(:event_id => event.id, :user_id => current_user.id), data: { confirm: 'Are you sure?' }, class: 'btn btn-primary btn-xs' %>
    <% end %>
  </p>

  <p>
  <% event.claims.each do |claim| %>
      <% if current_user == event.user && !claim.confirmed_by_teacher %>
        <p> <%= button_to "Confirm #{claim.user.name} as speaker", teacher_confirm_claim_path(claim, :event_id => event.id), data: { confirm: 'Are you sure?' }, class: 'btn btn-primary btn-xs' %> </p>
      <% end %>
      <% if current_user.id == claim.user_id then cancellation = 'Cancel Claim' end%>
      <% if current_user.id == event.speaker_id then cancellation = 'Cancel Speaking Engagement' end%>
      <% if (current_user.id == event.speaker_id and current_user.id == claim.user_id) or current_user.id == claim.user_id%>
          <p> <%= button_to cancellation, {action: "cancel", controller: "claims", id: claim.id}, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-primary' %> </p>
      <% end %>
      <% if current_user == event.user && claim.confirmed_by_teacher %>
          <p> <%= button_to "Give badge to #{claim.user.name}", speaker_confirm_claim_path(claim, :event_id => event.id), data: { confirm: 'Are you sure?' }, class: 'btn btn-primary btn-xs' %> </p>
      <% end %>
  <% end %>
  </p>


  <a>
  <% if current_user == event.user %>
    <%= button_to 'Edit the Event', {action: "edit", controller: "events", id:event.id}, method: :get, class: "btn-primary" %>
    <%= button_to 'Cancel The Event', {action: "cancel", controller: "events", id: event.id}, data: { confirm: 'Are you sure?' }, method: :delete, class: 'btn btn-primary btn-xs' %>
  <% else %>
    <%= button_to 'Message The Organizer', {action: "write_message", controller: "users", id: event.user_id}, method: :get, class:"btn-primary" %>    
  <% end %>
  </a>

</div> <!-- row -->
</li>